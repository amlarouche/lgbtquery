import Head from "next/head"
import { Box, Button, Flex, Heading, Input, Select, Text } from "@chakra-ui/react"
import axios from "axios"
import Link from "next/link"
import NavBar from "@/components/NavBar"
import { useState } from "react"
import ReposDisplay from "@/components/ReposDisplay"
import QuestionBox from "@/components/QuestionBox"
import MinimizeQuestionBox from "@/components/MinimizeQuestionBox"

export default function Home() {
  const [projectSearchTerm, setProjectSearchTerm] = useState("")
  const [languageSearchTerm, setLanguageSearchTerm] = useState("")
  const [reposArray, setReposArray] = useState([] as Record<string, any>[])
  const [openSearch, setOpenSearch] = useState<boolean>(true)
  const [open, setOpen] = useState<boolean>(false)

  const handleClick = async () => {
    if (openSearch) {
      const { data } = await axios.post("http://localhost:3000/api/repos", {
        searchTerm: projectSearchTerm,
        language: languageSearchTerm,
      })
      setReposArray(data)
    }
    setOpenSearch(!openSearch)
  }

  const questionBoxViews = {
    hidden: [<MinimizeQuestionBox key="QBH" />, "Again!"],
    view: [
      <QuestionBox
        key="QB"
        setProjectSearchTerm={setProjectSearchTerm}
        setLanguageSearchTerm={setLanguageSearchTerm}
      />,
      "Submit",
    ],
  }

  return (
    <>
      <Head>
        <title>LGBTQuery</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
      </Head>
      <NavBar isHomepage={true} />
      <Flex
        flexDir="column"
        justify="center"
        align="center"
        className="main-container"
        margin={reposArray.length > 0 ? "50px" : "50px"}
      >
        <Flex
          m="8px"
          border={"1px solid rgba(1, 65, 255, 0.2)"}
          borderRadius={"8px"}
          width={"40%"}
          height={openSearch ? "30%" : "20%"}
          padding="32px"
          align="center"
          flexDir="column"
          className="question-box"
        >
          <Heading size={"md"}>
            {openSearch ? "Find a queer coder - search for projects in the language you need: " : "Feel free to search again :)"}
          </Heading>
          {openSearch ? questionBoxViews.view[0] : questionBoxViews.hidden[0]}
          <Button onClick={handleClick} backgroundColor={"rgba(227, 156, 223,0.6)"}>
            {openSearch ? questionBoxViews.view[1] : questionBoxViews.hidden[1]}
          </Button>
        </Flex>
        {reposArray.length > 0 && <ReposDisplay repos={reposArray} />}
        <Text justifySelf="flex-end" fontSize="20px" className="nav-link">
          <Link href="/contact">Contact</Link>
        </Text>
      </Flex>

    </>
  )
}
